/**
 * @license jq-arcs v1.0.0
 * (c) 2018 Finsi, Inc.
 */

import*as svgProxy from"svgjs";import svgProxy__default,{}from"svgjs";var ArcsEvents;!function(t){t.beforeActivateItem="arcs:beforeActivateItem",t.activateItem="arcs:activateItem",t.complete="arcs:complete"}(ArcsEvents||(ArcsEvents={}));class ArcsItemSvg{constructor(t={}){void 0!=t.color&&(this.color=t.color),void 0!=t.start&&(this.start=t.start),void 0!=t.end&&(this.end=t.end),void 0!=t.stroke&&(this.stroke=t.stroke),void 0!=t.d&&(this.d=t.d),void 0!=t.arc&&(this.arc=t.arc),void 0!=t.totalLength&&(this.totalLength=t.totalLength)}}class ArcsItem{constructor(t={}){void 0!=t.$item&&(this.$item=t.$item),void 0!=t.back&&(t.back instanceof ArcsItemSvg?this.back=t.back:this.back=new ArcsItemSvg(t.back)),void 0!=t.mid&&(t.mid instanceof ArcsItemSvg?this.mid=t.mid:this.mid=new ArcsItemSvg(t.mid)),void 0!=t.fill&&(t.fill instanceof ArcsItemSvg?this.fill=t.fill:this.fill=new ArcsItemSvg(t.fill)),void 0!=t.group&&(this.group=t.group),void 0!=t.disabled&&(this.disabled=t.disabled),void 0!=t.activated&&(this.activated=t.activated)}}const SVG=svgProxy__default||svgProxy;class Arcs{constructor(){this._activated=0,this._current=-1}_create(){this.element.addClass(this.options.classes.root),this._svg=SVG(this.element.get(0)),this._position=this.options.viewBox/2,this._radius=this.options.viewBox/2-this.options.stroke,this._svg.viewbox(0,0,this.options.viewBox,this.options.viewBox),this.draw(!0)}draw(t=!1){t&&(this._findElements(),this._extractData(),this._activated=0,this._current=-1),this._draw(),this.options.lineal&&(t?this.next():this._updateCurrentItem())}next(){this.options.lineal&&(this._current++,this.setItemDisable(this._current,!1),this._updateCurrentItem())}setItemDisable(t,s){let i=this._items[t];i&&(i.disabled=s,s?(i.group.$node.addClass(this.options.classes.disabled),i.$item.addClass(this.options.classes.disabled)):(i.group.$node.removeClass(this.options.classes.disabled),i.$item.removeClass(this.options.classes.disabled)))}enableItem(t){this.setItemDisable(t,!1)}disableItem(t){this.setItemDisable(t,!0)}enable(){this._super&&this._super(),this.element.removeClass(this.options.classes.disabled)}disable(){this._super&&this._super(),this.element.addClass(this.options.classes.disabled)}activate(t){if(1!=this.options.disabled){let s=this._items[t];if(s&&1!=s.disabled)return s.group.$node.addClass(this.options.classes.activating),s.$item.addClass(this.options.classes.activating),s.group.off("click",this._onGroupClick),this._animate(s)}}_findElements(){this._$items=this.element.find(this.options.selectors.item),this._$items.addClass(this.options.classes.item)}_extractData(){let t=this._$items,s=[],i=this.options.limit,e=this.options.stroke,o=this.options.separation,a=this.options.back.border,r=this.options.mid.border,n=0,c=i/t.length;for(let i=0,d=t.length;i<d;i++){let d=$(t[i]),{back:back,mid:mid,fill:fill}=this._calculateItemArcs(n,c,e,o,a,r);back=$.extend(!0,{},this.options.back,back),mid=$.extend(!0,{},this.options.mid,mid),fill=$.extend(!0,{},this.options.fill,fill);let l=new ArcsItem({$item:d,back:back,mid:mid,fill:fill,disabled:this.options.lineal,activated:!1});s.push(l),n+=c}this._items=s}_calculateItemArcs(t,s,i,e,o,a){let r=e/2,n=r+o,c=n+a,d=i-2*o;return{back:{start:t+r,end:t+s-r,stroke:i},mid:{start:t+n,end:t+s-n,stroke:d},fill:{start:t+c,end:t+s-c,stroke:d-2*a}}}_updateCurrentItem(){if(this.options.lineal){let t=this._items[this._current-1];t&&(t.group.$node.removeClass(this.options.classes.current),t.$item.removeClass(this.options.classes.current));let s=this._items[this._current];s&&(s.group.$node.addClass(this.options.classes.current),s.$item.addClass(this.options.classes.current))}}_getCreateOptions(){return{viewBox:200,limit:360,stroke:30,separation:10,selectors:{item:"[data-arcs-item]"},classes:{root:"jq-arcs",item:"jq-arcs__item",group:"jq-arcs__group",arc:"jq-arcs__arc",back:"jq-arcs__arc-back",mid:"jq-arcs__arc-mid",fill:"jq-arcs__arc-fill",disabled:"jq-arcs--disabled",activating:"jq-arcs--activating",activated:"jq-arcs--activated",current:"jq-arcs--current"},back:{color:"#000",border:2},mid:{color:"#fff",border:0},fill:{color:"#2196F3"},animation:{duration:800,ease:"<>",delay:0},lineal:!0}}_draw(){if(this._draws){let t=this._draws;for(let s=0,i=t.length;s<i;s++){let i=t[s];i.remove()}}this._draws=[];let t=this._items;for(let s=0,i=t.length;s<i;s++){let i=t[s],{back:back,mid:mid,fill:fill}=i,e=this._svg.group();i.group=e,e.attr({class:this.options.classes.group}),back.d=this._describeArc(this._position,this._position,this._radius,back.start,back.end),mid.d=this._describeArc(this._position,this._position,this._radius,mid.start,mid.end),fill.d=this._describeArc(this._position,this._position,this._radius,fill.start,fill.end),back.arc=e.path(back.d).fill("none").stroke({width:back.stroke,color:this.options.back.color}).attr({class:this.options.classes.arc+" "+this.options.classes.back}),back.arc.$node=$(back.arc.node),mid.arc=e.path(mid.d).fill("none").stroke({width:mid.stroke,color:this.options.mid.color}).attr({class:this.options.classes.arc+" "+this.options.classes.mid}),mid.arc.$node=$(mid.arc.node),fill.arc=e.path(fill.d).fill("none").stroke({width:fill.stroke,color:this.options.fill.color}).attr({class:this.options.classes.arc+" "+this.options.classes.fill}),fill.arc.$node=$(fill.arc.node);let o=fill.arc.node.getTotalLength();fill.totalLength=o,fill.arc.attr({"stroke-dasharray":o+" "+o,"stroke-dashoffset":1!=i.activated?-o:0}),e.on("click",this._onGroupClick.bind(this,s)),e.$node=$(e.node),this.setItemDisable(s,i.disabled),this._draws.push(e)}}_onGroupClick(t){this.activate(t)}_polarToCartesian(t,s,i,e){let o=(e-90)*Math.PI/180;return{x:t+i*Math.cos(o),y:s+i*Math.sin(o)}}_describeArc(t,s,i,e,o){let a=this._polarToCartesian(t,s,i,o),r=this._polarToCartesian(t,s,i,e),n=o-e<=180?"0":"1";return["M",a.x,a.y,"A",i,i,0,n,0,r.x,r.y].join(" ")}_onAnimationEnd(t,s){s.resolve(t),t.activated=!0,t.group.$node.removeClass(this.options.classes.activating),t.$item.removeClass(this.options.classes.activating),t.group.$node.addClass(this.options.classes.activated),t.$item.addClass(this.options.classes.activated),this._activated++,this.options.lineal&&this.next(),this.element.trigger(ArcsEvents.activateItem,[this,t]),this._activated==this._items.length&&this.element.trigger(ArcsEvents.complete,[this])}_animate(t){let s=$.Deferred();return 1!=this.options.disabled&&t&&1!=t.disabled?(this.element.trigger(ArcsEvents.beforeActivateItem,[this,t]),t.fill.arc.animate(this.options.animation.duration,this.options.animation.ease,this.options.animation.delay).attr({"stroke-dashoffset":0}).afterAll(this._onAnimationEnd.bind(this,t,s))):s.rejectWith(this,[t]),s.promise()}}if(Object.hasOwnProperty("getOwnPropertyDescriptors")){let t={},s=Object.getOwnPropertyNames(Arcs.prototype);for(let i=0,e=s.length;i<e;i++){let e=s[i];t[e]=Object.getOwnPropertyDescriptor(Arcs.prototype,e).value}$.widget("ui.arcs",t)}else $.widget("ui.arcs",Arcs.prototype);export{ArcsEvents,ArcsItemSvg,ArcsItem,Arcs};
